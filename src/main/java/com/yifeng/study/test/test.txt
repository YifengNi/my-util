 SELECT ro.REPAIR_ORDER_CODE,/*PDI单号*/
		 (CASE WHEN (DATEDIFF(NOW(),ro.DELIVERY_DATE) > LOOKUP1.LOOKUP_VALUE_NAME) THEN '已过期' WHEN ((DATEDIFF(NOW(),ro.DELIVERY_DATE) <= LOOKUP1.LOOKUP_VALUE_NAME) AND ro.repair_order_status='31011') THEN '通过' WHEN ro.repair_order_status IS NULL THEN '未发起新车PDI' WHEN RO.repair_order_status = '31014' THEN 'PDI已作废' ELSE '进行中' END) PDI_STATE,/*PID状态*/
		 ro.VIN,
		 F_DB_GETLOOKVALUE('SE0029', ro.IS_GATHER, '') IS_GATHER_STATE,
		 DATE_FORMAT(ro.PRE_GET_DATE,'%Y-%m-%d') PRE_GET_DATE,
		 DATE_FORMAT(ro.DELIVERY_DATE,'%Y-%m-%d %H:%i:%s') DELIVERY_DATE,/*pdi完成时间 */
		 DATE_FORMAT(ro.CREATED_DATE,'%Y-%m-%d %H:%i:%s') SEND_CREATED_DATE,
		 od1.DLR_SHORT_NAME AS SERVICE_DLR_NAME,/*服务中心*/
		 od2.DLR_SHORT_NAME AS DELIVERY_DLR_NAME,/*交付中心*/ 
		 ro.CREATOR AS CREATE_NO, 
		  (SELECT B.EMP_NAME FROM t_eap_sys_user A JOIN T_MDM_ORG_EMPLOYEE B ON A.EMP_ID = B.EMP_ID WHERE A.USER_ID = ro.CREATOR) AS CREATOR /*PDI发起人*/   
		 FROM T_SE_BU_REPAIR_ORDER ro 
		 LEFT JOIN t_ve_dlr_car_store cs ON ro.VIN=cs.VIN 
		 LEFT JOIN T_MDS_LOOKUP_VALUE LOOKUP1 ON LOOKUP1.LOOKUP_TYPE_CODE = 'VE1105' AND LOOKUP1.IS_ENABLE = '1' 
		 LEFT JOIN t_mdm_org_dlr od1 ON ro.DLR_ID=od1.DLR_ID 
		 LEFT JOIN t_mdm_org_dlr od2 ON cs.DLR_ID=od2.DLR_ID 
		 LEFT JOIN t_mdm_org_employee oe ON ro.CREATOR = oe.EMP_ID
		 WHERE ro.bill_type = '31802'



